<html>
<head>
    <title>Tidéns fantastiska familjereceptssamlingsportal</title>
    <script type="text/javascript" src="yaml.min.0.3.0.js"></script>
    <script src="https://unpkg.com/petite-vue"></script>
    <meta charset="UTF-8"> 
    <link rel="stylesheet" href="style.css">

    <script type="module">
        function onlyUnique(value, index, array) {
            return array.indexOf(value) === index;
        }
        let allaRecepten = YAML.load('data.yml');


        const urlParams = new URLSearchParams(window.location.search);
        const q = urlParams.get('q');
        const r = urlParams.get('r');

        const page = r !== null ? 'article' : 'list';

        PetiteVue.createApp({
            page: page,
            allaRecepten: allaRecepten,
            allaTaggar: allaRecepten.flatMap(recept => recept.tags).filter(onlyUnique).sort(),
            filter: q,
            recept: allaRecepten.filter(recept => recept.name === r)[0],
            get receptenFiltered() {
                if (this.filter) {
                    return allaRecepten.filter(r => JSON.stringify(r).toUpperCase().indexOf(this.filter.toUpperCase()) !== -1);
                } else {
                    return allaRecepten;
                }
            },
 
        }).mount()
    </script>
</head>
<!--- ----------------------------------------------------------------->
<!--- ----------------------------------------------------------------->
<!--- ----------------------------------------------------------------->
<!--- ----------------------------------------------------------------->
<!--- ----------------------------------------------------------------->

<body>
    <header>
        <a href="?q"><h1>Tidéns fantastiska familjereceptssamlingsportal</h1></a>

        <label for="sök">
            Sök här:
            <input id="sök" type="text" v-model="filter"></input>
        </label>
        <div class="navTaggarDiv">
            <a class="navTag" :href="`?q=${tag}`" v-for="tag in allaTaggar">#{{tag}}</a>
        </div>
    </header>
    <main>
        <div class="receptList" v-if="page === 'list'">
            <div v-for="recept in receptenFiltered" class="receptCard" >
                <img class="receptImage" :src="recept.bild" alt="Receptbild">
                <a :href="`?r=${recept.name}`"><h2>{{recept.name}}</h2></a>
                <a class="cardTag" :href="`?q=${tag}`" v-for="tag in recept.tags">#{{tag}}</a>
            </div>
        </div>

        <div class="article" v-if="page === 'article'">
            <img class="receptImage" :src="recept.bild" alt="Receptbild">
            <h2>{{recept.name}}</h2>
            <a class="cardTag" :href="`?q=${tag}`" v-for="tag in recept.tags">#{{tag}}</a>
            <ul>
                <li v-for="ingrediens in recept.ingredienser">{{ingrediens}}</li>
            </ul>
            
            <hr/>
            <ol>
                <li v-for="instruktion in recept.instruktioner">{{instruktion}}</li>
            </ol>
        </div>
    </main>
    <footer>footer</footer>
</body>
</html>